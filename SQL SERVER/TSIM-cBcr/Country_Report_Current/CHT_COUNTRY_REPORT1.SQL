WITH COUNTRY AS (SELECT 
    T1.ID,
    T1.PERIOD,
    T4.COUNTRY_ID AS ID1,
    T4.COUNTRY_NAME AS NAME,
    T1.DATA_NAME,
    TRY_CAST(T1.VALUE AS DECIMAL(38,2)) AS VALUE  
FROM 
    [dbo].[TRS_FACT_COUNTRY_REPORT] T1
LEFT JOIN
    TRSDB.dbo.V_TRS_DIM_ENTITY_CUR T2
ON T1.ENTITY_ID = T2.ENTITY_CODE 
LEFT JOIN 
    V_TRS_DIM_ENTITY T3
ON T1.ENTITY_ID = T3.ENTITY_ID
LEFT JOIN 
    V_TRS_DIM_COUNTRY T4
ON T3.COUNTRY_ID = T4.COUNTRY_ID
WHERE
T1.REPORT_NAME = 'report1'
AND T3.FR_LOCALE='${fr_locale}'
AND T1.DATA_NAME = '${P_CATEGORY1}'
AND T1.PERIOD = '${P_PERIOD}'
AND T3.COUNTRY_ID IN ('${P_COUNTRY}')), COMPANY AS (
    SELECT 
    T1.ID,
    T1.PERIOD,
    T2.current_code AS ID1,
    T3.ENTITY_NAME AS NAME,
    T1.DATA_NAME,
    TRY_CAST(T1.VALUE AS DECIMAL(38,2)) AS VALUE  
FROM 
    [dbo].[TRS_FACT_COUNTRY_REPORT] T1
LEFT JOIN
    TRSDB.dbo.V_TRS_DIM_ENTITY_CUR T2
ON T1.ENTITY_ID = T2.ENTITY_CODE 
LEFT JOIN 
    V_TRS_DIM_ENTITY T3
ON T1.ENTITY_ID = T3.ENTITY_ID
WHERE
--1=1 
T1.REPORT_NAME = 'report1'
AND T3.FR_LOCALE='${fr_locale}'
AND T1.DATA_NAME = '${P_CATEGORY1}'
AND T1.PERIOD = '${P_PERIOD}'
AND T1.ENTITY_ID IN ('${P_COMPANY}')
AND T3.COUNTRY_ID IN ('${P_COUNTRY}')
)
SELECT 
ID,
PERIOD,
ID1,
NAME,
DATA_NAME,
VALUE
FROM
${(IF(BTN_TYPE=='1', "COMPANY", "COUNTRY"))}