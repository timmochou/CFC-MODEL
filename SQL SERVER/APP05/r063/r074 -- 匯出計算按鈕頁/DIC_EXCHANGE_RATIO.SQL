SELECT DISTINCT
	T1.CURRENCY_CODE,
	FORMAT(T2.AVG_EXCHANGE_RATIO, '#,###.00000') AS AVG_EXCHANGE_RATIO
FROM TRS_FACT_TRIAL_BALANCE T1
LEFT JOIN V_TRS_FACT_EXCHANGE_BANKOFTW T2 ON CONCAT(T1.PERIOD,'-', RIGHT('0' + T1.MONTH,2)) = T2.PERIOD AND T1.CURRENCY_CODE = T2.CURRENCY_ID  AND T2.TARGET_CURRENCY_ID = 'NTD' AND T1.SCENARIO = T2.SCENARIO 
LEFT JOIN V_TRS_DIM_ENTITY_CUR t3 ON t1.ENTITY_CODE = t3.ENTITY_CODE
WHERE 1 = 1
	--AND t3.CURRENT_CODE = '${P_CFC}'
	AND CONCAT(T1.PERIOD,'-', RIGHT('0' + T1.MONTH,2))= '${P_DATE}'
	AND t1.SCENARIO = '${P_VERSION}'


SELECT
	t1.ID,
	t1.INV_ENTITY_CODE,
	t1.CREATED_TIME,
	t1.CREATED_BY,
	T1.DESPITE_PROFIT_ORI,
	T1.FVPL_AMOUNT_ORI,
	T1.FVPL_FVCHANGE_ORI,
	T1.RE_FVPL_AMOUNT_ORI,
	T1.CURRENCY_CODE,
    T3.CURRENCY_CODE,
	FORMAT(T4.AVG_EXCHANGE_RATIO, '#,###.00000') AS AVG_EXCHANGE_RATIO
FROM V_TRS_FACT_CFC_OTHER_AMOUNT t1
LEFT JOIN V_TRS_DIM_ENTITY_CUR t2 ON t1.INV_ENTITY_CODE = t2.ENTITY_CODE
LEFT JOIN TRS_FACT_TRIAL_BALANCE t3 ON t1.INV_ENTITY_CODE = t3.ENTITY_CODE AND t1.CURRENCY_CODE = t3.CURRENCY_CODE AND CONCAT(t1.PERIOD,'-', RIGHT('0' + t1.MONTH,2)) = CONCAT(t3.PERIOD,'-', RIGHT('0' + t3.MONTH,2)) AND t1.SCENARIO = t3.SCENARIO
LEFT JOIN V_TRS_FACT_EXCHANGE_BANKOFTW t4 ON t1.CURRENCY_CODE = t4.CURRENCY_ID AND t4.TARGET_CURRENCY_ID = 'NTD' AND t1.SCENARIO = t4.SCENARIO
WHERE 1 = 1
AND FORMAT(t1.PERIOD, 'yyyy-MM') = '${P_DATE}'
AND t1.SCENARIO = '${P_VERSION}'

